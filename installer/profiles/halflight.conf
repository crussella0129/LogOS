# LogOS Ringed City Profile: HALFLIGHT
# Performance-Focused Configuration
# "Halflight, Spear of the Church" - Swift aggression unencumbered by caution

################################################################################
# Profile Metadata
################################################################################

PROFILE_NAME="Halflight"
PROFILE_DESCRIPTION="Performance Focus"
PROFILE_KERNEL="linux-zen"
PROFILE_USE_CASE="Gaming, media production, HPC, benchmarking"
PROFILE_PERFORMANCE_IMPACT="None (security mitigations disabled for max performance)"

################################################################################
# Kernel Selection
################################################################################

# Primary kernel (Zen for maximum performance)
KERNEL_PRIMARY="linux-zen"
KERNEL_PRIMARY_HEADERS="linux-zen-headers"

# Fallback kernel
KERNEL_FALLBACK="linux"
KERNEL_FALLBACK_HEADERS="linux-headers"

################################################################################
# Kernel Parameters
################################################################################

KERNEL_PARAMS=(
    # Core security (basic only)
    "audit=1"
    "apparmor=1"

    # LSM stack (minimal)
    "lsm=landlock,lockdown,yama,integrity,apparmor,bpf"

    # CPU mitigations DISABLED for performance
    "mitigations=off"

    # Enable SMT/Hyperthreading
    # (no nosmt parameter)

    # Memory protection (minimal)
    # Skip init_on_alloc for performance

    # IOMMU (passthrough for performance)
    "iommu.passthrough=1"

    # Performance mode
    "processor.max_cstate=1"
    "intel_idle.max_cstate=0"

    # Quiet boot
    "quiet"
    "loglevel=3"
)

################################################################################
# Sysctl Security Parameters
################################################################################

SYSCTL_PARAMS=(
    # Network hardening (minimal - connectivity over paranoia)
    "net.ipv4.tcp_syncookies=1"
    "net.ipv4.conf.all.accept_redirects=0"
    "net.ipv6.conf.all.accept_redirects=0"
    "net.ipv4.conf.all.send_redirects=0"
    "net.ipv4.conf.all.rp_filter=1"

    # Kernel hardening (minimal)
    "kernel.randomize_va_space=2"
    "kernel.dmesg_restrict=0"
    "kernel.kptr_restrict=1"
    "kernel.perf_event_paranoid=1"  # Allow performance monitoring
    "kernel.yama.ptrace_scope=0"    # Allow debugging

    # Filesystem hardening (basic)
    "fs.protected_hardlinks=1"
    "fs.protected_symlinks=1"
    "fs.suid_dumpable=0"

    # Performance tuning
    "vm.swappiness=10"
    "vm.vfs_cache_pressure=50"
    "vm.dirty_ratio=10"
    "vm.dirty_background_ratio=5"

    # Network performance
    "net.core.netdev_max_backlog=16384"
    "net.core.somaxconn=8192"
    "net.ipv4.tcp_fastopen=3"
    "net.ipv4.tcp_tw_reuse=1"
)

################################################################################
# Security Services
################################################################################

ENABLE_SERVICES=(
    "apparmor"  # Keep AppArmor even in performance mode
    "ufw"       # Basic firewall
)

# Disable audit for performance
DISABLE_SERVICES=(
    "auditd"    # Audit has performance overhead
    "fail2ban"  # Not needed for performance workloads
)

################################################################################
# Firewall Configuration
################################################################################

UFW_DEFAULT_INCOMING="deny"
UFW_DEFAULT_OUTGOING="allow"
UFW_DEFAULT_FORWARD="allow"  # Allow forwarding for VMs/containers
UFW_LOG_LEVEL="off"  # Disable logging for performance

# Gaming/streaming ports
UFW_ALLOW_PORTS=(
    # Add as needed for specific games/apps
)

################################################################################
# AppArmor Configuration
################################################################################

APPARMOR_MODE="complain"  # Complain mode (log but don't block)

# Most profiles in complain for compatibility
APPARMOR_COMPLAIN_PROFILES=(
    "*"  # All profiles in complain mode
)

################################################################################
# Audit Configuration
################################################################################

# Audit disabled for performance
AUDIT_BUFFER_SIZE="0"
AUDIT_FAILURE_MODE="0"
AUDIT_RULES=()

################################################################################
# Power Management
################################################################################

# Performance power settings
CPU_GOVERNOR="performance"
CPU_BOOST="1"
PLATFORM_PROFILE="performance"

# Disable power saving features
DISABLE_POWER_SAVING="yes"

################################################################################
# Additional Hardening
################################################################################

# No module blacklist (maximum compatibility)
BLACKLIST_MODULES=()

# USB devices fully allowed
USB_AUTHORIZED_DEFAULT="1"

# Secure boot not required
REQUIRE_SECURE_BOOT="no"

################################################################################
# Network Configuration
################################################################################

# Enable IPv6
DISABLE_IPV6="no"

# No MAC randomization (can interfere with gaming)
WIFI_MAC_RANDOMIZATION="no"

# Standard DNS
USE_DNS_OVER_TLS="no"

################################################################################
# Performance Optimizations
################################################################################

# Gaming optimizations
ENABLE_GAMEMODE="yes"
ENABLE_GAMEMODE_AUTO="yes"

# CPU scheduling optimizations
CPU_SCHED_AUTOGROUP="0"
CPU_SCHED_LATENCY="1000000"  # 1ms

# I/O scheduler
IO_SCHEDULER="none"  # For NVMe, use none for best performance
IO_SCHEDULER_SATA="mq-deadline"

# Disable watchdogs for performance
DISABLE_WATCHDOGS="yes"

# Graphics optimizations
ALLOW_TEARING="yes"  # For lower latency
ENABLE_FREESYNC="yes"

################################################################################
# Desktop Integration
################################################################################

# Optimize for gaming/media
DESKTOP_OPTIMIZED="performance"

# Allow all user applications
ALLOW_FLATPAK="yes"
ALLOW_APPIMAGE="yes"
ALLOW_WINE="yes"

# Disable unnecessary services
DISABLE_BLUETOOTH_ON_BOOT="yes"
DISABLE_PRINTER_ON_BOOT="yes"

################################################################################
# Filesystem Optimizations
################################################################################

# Use noatime for performance
MOUNT_OPTIONS_ROOT="noatime,compress=zstd:1"  # Lower compression for speed
MOUNT_OPTIONS_HOME="noatime,compress=zstd:1"

# Disable CoW for gaming directories
NOCOW_DIRECTORIES=(
    "~/.local/share/Steam"
    "~/Games"
    "~/.wine"
)

################################################################################
# Notes
################################################################################

# Halflight is designed for MAXIMUM PERFORMANCE.
# Security mitigations that impact performance are disabled.
#
# WARNING: This profile should ONLY be used when:
# - You are on a trusted network (home, private network)
# - You are not handling sensitive data
# - Performance is the top priority (gaming, rendering, simulations)
# - You understand the security trade-offs
#
# DO NOT USE for:
# - Sensitive work
# - Untrusted networks
# - Processing confidential data
# - Production servers
#
# Typical use cases:
# - Gaming sessions
# - Video editing and rendering
# - 3D modeling and CAD work
# - Scientific simulations
# - Benchmarking
# - Media production workflows
#
# Switch to Midir or Gael when handling sensitive operations.
